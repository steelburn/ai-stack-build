<!DOCTYPE html>
<html>
<head>
    <title>Logs - AI Stack Monitor</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <style>
        body { font-family: 'Courier New', monospace; background-color: #1e1e1e; color: #f8f8f2; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .back-link { color: #61dafb; text-decoration: none; margin-bottom: 20px; display: inline-block; }
        .back-link:hover { text-decoration: underline; }
        .logs-container { background: #2d2d2d; border-radius: 8px; padding: 20px; margin-top: 20px; }
        .log-line { margin: 2px 0; padding: 2px 0; border-bottom: 1px solid #444; }
        .log-line:last-child { border-bottom: none; }
        .log-timestamp { color: #888; margin-right: 10px; }
        .log-level { font-weight: bold; margin-right: 10px; }
        .log-level-error { color: #ff6b6b; }
        .log-level-warn { color: #ffd93d; }
        .log-level-info { color: #6bcf7f; }
        .log-level-debug { color: #4ecdc4; }
        .controls { margin-bottom: 20px; display: flex; gap: 10px; align-items: center; }
        select, input { padding: 8px; border-radius: 4px; border: 1px solid #555; background: #333; color: #fff; }
        button { background: #61dafb; color: #000; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; }
        button:hover { background: #4fa8d1; }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="back-link">‚Üê Back to Dashboard</a>
        <h1>Logs - <span id="service-name">Loading...</span></h1>

        <div class="controls">
            <select id="level-filter">
                <option value="all">All Levels</option>
                <option value="error">Errors</option>
                <option value="warn">Warnings</option>
                <option value="info">Info</option>
                <option value="debug">Debug</option>
            </select>
            <input type="text" id="search-input" placeholder="Search logs...">
            <select id="lines-select">
                <option value="50">50 lines</option>
                <option value="100">100 lines</option>
                <option value="200">200 lines</option>
                <option value="500">500 lines</option>
            </select>
            <button onclick="loadLogs()">Refresh</button>
        </div>

        <div class="logs-container">
            <div id="logs-content">Loading logs...</div>
        </div>
    </div>

    <script>
        const serviceName = window.location.pathname.split('/logs/')[1];

        document.getElementById('service-name').textContent = serviceName;
        document.title = `Logs - ${serviceName}`;

        async function loadLogs() {
            const level = document.getElementById('level-filter').value;
            const search = document.getElementById('search-input').value;
            const lines = document.getElementById('lines-select').value;

            const params = new URLSearchParams({
                level: level,
                search: search,
                lines: lines
            });

            try {
                const response = await fetch(`/api/logs/${serviceName}?${params}`);
                const data = await response.json();

                if (data.error) {
                    document.getElementById('logs-content').innerHTML = `<div style="color: #ff6b6b;">${data.error}</div>`;
                    return;
                }

                renderLogs(data.logs);
            } catch (error) {
                document.getElementById('logs-content').innerHTML = `<div style="color: #ff6b6b;">Error loading logs: ${error.message}</div>`;
            }
        }

        function renderLogs(logs) {
            const container = document.getElementById('logs-content');
            container.innerHTML = '';

            if (logs.length === 0) {
                container.innerHTML = '<div style="color: #888;">No logs found</div>';
                return;
            }

            logs.forEach(log => {
                const logElement = document.createElement('div');
                logElement.className = 'log-line';

                // Parse log line for timestamp and level
                const timestamp = log.substring(0, 30);
                const rest = log.substring(30);
                const levelMatch = rest.match(/\b(ERROR|WARN|INFO|DEBUG)\b/i);
                const level = levelMatch ? levelMatch[1] : 'UNKNOWN';

                logElement.innerHTML = `
                    <span class="log-timestamp">${timestamp}</span>
                    <span class="log-level log-level-${level.toLowerCase()}">${level}</span>
                    <span>${rest}</span>
                `;

                container.appendChild(logElement);
            });
        }

        // Load logs on page load
        loadLogs();

        // Auto-refresh every 30 seconds
        setInterval(loadLogs, 30000);
    </script>
</body>
</html>